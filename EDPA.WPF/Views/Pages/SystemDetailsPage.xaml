<Page
    x:Class="EDPA.WPF.Views.Pages.SystemDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:converters="clr-namespace:EDPA.WPF.Effects"
    xmlns:local="clr-namespace:EDPA.WPF.Config"
    Title="System Details"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:ScoreToColorConverter x:Key="ScoreToColorConverter"/>
        <converters:ScoreToPercentageConverter x:Key="ScoreToPercentageConverter"/>
        <converters:WeightToColorConverter x:Key="WeightToColorConverter"/>
        <converters:ScoreToStarVisibilityConverter x:Key="ScoreToStarVisibilityConverter"/>
        <local:WeightedScoreToPercentageConverter x:Key="WeightedScoreToPercentageConverter"/>

        <!-- Fallback brushes -->
        <SolidColorBrush x:Key="FallbackBackground" Color="#2B2B2B"/>
        <SolidColorBrush x:Key="FallbackForeground" Color="#BFBFBF"/>
        <SolidColorBrush x:Key="FallbackSecondaryText" Color="#D6D6D6"/>
        <SolidColorBrush x:Key="FallbackBorder" Color="#454545"/>
        <SolidColorBrush x:Key="FallbackCardBackground" Color="#383838"/>

        <!-- Style for section headers -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Foreground" Value="{StaticResource FallbackForeground}"/>
        </Style>

        <!-- Style for label text -->
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,8,8"/>
            <Setter Property="Foreground" Value="{StaticResource FallbackForeground}"/>
        </Style>

        <!-- Style for value text -->
        <Style x:Key="ValueStyle" TargetType="TextBlock">
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="Foreground" Value="{StaticResource FallbackSecondaryText}"/>
        </Style>

        <!-- Style for score value text -->
        <Style x:Key="ScoreValueStyle" TargetType="TextBlock" BasedOn="{StaticResource ValueStyle}">
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>

        <!-- Style for recommendation text -->
        <Style x:Key="RecommendationStyle" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
            <Setter Property="Foreground" Value="{StaticResource FallbackForeground}"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid Background="{StaticResource FallbackBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <!-- Navigation Header -->
            <Border Grid.Row="0" Background="{StaticResource FallbackCardBackground}" Padding="16,12">
                <StackPanel Orientation="Horizontal">
                    <ui:Button 
                        Icon="{ui:SymbolIcon ArrowLeft24}"
                        Content="Back to Search"
                        Click="BackButton_Click"
                        Margin="0,0,16,0"
                        Appearance="Secondary"/>
                    <TextBlock 
                        Text="{Binding SystemName, StringFormat='System Details: {0}'}"
                        FontSize="20"
                        FontWeight="SemiBold"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource FallbackForeground}"/>
                    <ui:Button
                        x:Name="SaveButton"
                        Icon="{ui:SymbolIcon Save28}"
                        Content=""
                        Click="SaveButton_Click"
                        Appearance="Secondary"
                        Margin="30,0,0,0"/>
                    <ui:TextBlock 
                        x:Name="AlreadySavedText"
                        FontSize="20"
                        Text="Already Saved"
                        VerticalAlignment="Center"
                        Margin="30,0,30,0"
                        Foreground="{StaticResource FallbackForeground}"
                        Visibility="Collapsed"/>
                    <!-- Optional: Remove Button for saved systems -->
                    <ui:Button x:Name="RemoveButton"
                        Icon="{ui:SymbolIcon Delete24}"
                        Content=""
                        Click="RemoveButton_Click"
                        Appearance="Secondary"
                        Visibility="Collapsed"/>
                    <!-- Remove Status Message -->
                    <TextBlock x:Name="RemoveStatusText"
                        Text=""
                        VerticalAlignment="Center"
                        Margin="0,0,10,0"
                        Visibility="Collapsed"/>

                </StackPanel>
            </Border>

            <!-- System Details Content -->
            <ui:DynamicScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16">
                <StackPanel Background="Transparent">
                    <!-- Basic Information Card -->
                    <Border Background="{StaticResource FallbackCardBackground}" 
                CornerRadius="4" 
                Padding="16"
                Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <ui:SymbolIcon Symbol="Info24" 
                            Foreground="{StaticResource FallbackForeground}"
                            Margin="0,-10,8,0"
                            VerticalAlignment="Center"/>
                                <TextBlock VerticalAlignment="Bottom" Text="Basic Information" Style="{StaticResource SectionHeaderStyle}"/>
                                <StackPanel Orientation="Horizontal" Margin="10,0,0,8">
                                    <ui:SymbolIcon Symbol="Star24" 
                                Foreground="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                Margin="0,0,2,0"
                                Visibility="{Binding FinalScore, Converter={StaticResource ScoreToStarVisibilityConverter}, ConverterParameter=1}"/>
                                    <ui:SymbolIcon Symbol="Star24" 
                                Foreground="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                Margin="0,0,2,0"
                                Visibility="{Binding FinalScore, Converter={StaticResource ScoreToStarVisibilityConverter}, ConverterParameter=2}"/>
                                    <ui:SymbolIcon Symbol="Star24" 
                                Foreground="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                Margin="0,0,2,0"
                                Visibility="{Binding FinalScore, Converter={StaticResource ScoreToStarVisibilityConverter}, ConverterParameter=3}"/>
                                    <ui:SymbolIcon Symbol="Star24" 
                                Foreground="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                Margin="0,0,2,0"
                                Visibility="{Binding FinalScore, Converter={StaticResource ScoreToStarVisibilityConverter}, ConverterParameter=4}"/>
                                    <ui:SymbolIcon Symbol="Star24" 
                                Foreground="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                Visibility="{Binding FinalScore, Converter={StaticResource ScoreToStarVisibilityConverter}, ConverterParameter=5}"/>
                                </StackPanel>
                            </StackPanel>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="System Name:" Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <TextBlock Text="{Binding SystemName}" Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="3" Style="{StaticResource ValueStyle}"/>

                                <TextBlock Text="Final Score:" Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelStyle}" VerticalAlignment="Bottom"/>
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Border 
                                Background="{Binding FinalScore, Converter={StaticResource ScoreToColorConverter}}"
                                CornerRadius="12"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Left"
                                Padding="12,4"
                                Margin="0,0,8,4">
                                        <TextBlock Text="{Binding FinalScore, StringFormat='{}{0:F0}'}"
                                   FontWeight="Bold"
                                   FontSize="14" 
                                   Foreground="White"
                                   HorizontalAlignment="Center"/>
                                    </Border>
                                    <TextBlock Text="/100" 
                               Style="{StaticResource ValueStyle}"
                               VerticalAlignment="Bottom"/>
                                </StackPanel>

                                <!-- Economy Score -->
                                <TextBlock Text="Economy:" Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="2" Grid.Column="1" 
                             Value="{Binding EconomyScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Economy'}" 
                             Maximum="100"
                             Height="8"
                             Margin="0,0,8,8"
                             VerticalAlignment="Center"
                             Foreground="{Binding EconomyScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='Economy'}"/>
                                <TextBlock Text="{Binding EconomyDescription}" 
                            Grid.Row="3" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding EconomyScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Economy', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="2" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>

                                <!-- Government Score -->
                                <TextBlock Text="Government:" Grid.Row="4" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="4" Grid.Column="1" 
                            Value="{Binding GovernmentScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Government'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,8"
                            VerticalAlignment="Center"
                            Foreground="{Binding GovernmentScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='Government'}"/>
                                <TextBlock Text="{Binding GovernmentDescription}" 
                            Grid.Row="5" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding GovernmentScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Government', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="4" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>

                                <!-- Population Score -->
                                <TextBlock Text="Population:" Grid.Row="6" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="6" Grid.Column="1" 
                            Value="{Binding PopulationScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Population'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,8"
                            VerticalAlignment="Center"
                            Foreground="{Binding PopulationScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='Population'}"/>
                                <TextBlock Text="{Binding PopulationDescription}" 
                            Grid.Row="7" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding PopulationScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Population', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="6" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Additional Information Card -->
                    <Border Background="{StaticResource FallbackCardBackground}" 
                CornerRadius="4" 
                Padding="16"
                Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <ui:SymbolIcon Symbol="DataHistogram24" 
                            Foreground="{StaticResource FallbackForeground}"
                             Margin="0,-10,8,0"/>
                                <TextBlock Text="Additional Information" Style="{StaticResource SectionHeaderStyle}"/>
                            </StackPanel>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- No Rings Score -->
                                <TextBlock Text="No Rings:" Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="0" Grid.Column="1" 
                            Value="{Binding NoRingsScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='NoRings'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,8"
                            VerticalAlignment="Center"
                            Foreground="{Binding NoRingsScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='NoRings'}"/>
                                <TextBlock Text="{Binding NoRingsDescription}" 
                            Grid.Row="1" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding NoRingsScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='NoRings', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="0" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Center"/>

                                <!-- Security Score -->
                                <TextBlock Text="Security:" Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="2" Grid.Column="1" 
                            Value="{Binding SecurityScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Security'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,8"
                            VerticalAlignment="Center"
                            Foreground="{Binding SecurityScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='Security'}"/>
                                <TextBlock Text="{Binding SecurityDescription}" 
                            Grid.Row="3" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding SecurityScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='Security', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="2" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>

                                <!-- Faction State Score -->
                                <TextBlock Text="Faction State:" Grid.Row="4" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="4" Grid.Column="1" 
                            Value="{Binding FactionStateScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='FactionState'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,8"
                            VerticalAlignment="Center"
                            Foreground="{Binding FactionStateScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='FactionState'}"/>
                                <TextBlock Text="{Binding FactionStateDescription}" 
                            Grid.Row="5" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding FactionStateScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='FactionState', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="4" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>

                                <!-- Market Demand Score -->
                                <TextBlock Text="Market Demand:" Grid.Row="6" Grid.Column="0" Style="{StaticResource LabelStyle}"/>
                                <ProgressBar Grid.Row="6" Grid.Column="1" 
                            Value="{Binding MarketDemandScore, Mode=OneWay, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='MarketDemand'}" 
                            Maximum="100"
                            Height="8"
                            Margin="0,0,8,0"
                            VerticalAlignment="Center"
                            Foreground="{Binding MarketDemandScore, Converter={StaticResource WeightToColorConverter}, ConverterParameter='MarketDemand'}"/>
                                <TextBlock Text="{Binding MarketDemandDescription}" 
                            Grid.Row="7" Grid.Column="1" 
                            Style="{StaticResource ValueStyle}"
                            Margin="0,-8,8,16"
                            VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding MarketDemandScore, Converter={StaticResource ScoreToPercentageConverter}, ConverterParameter='MarketDemand', StringFormat='{}{0:F0}%'}" 
                            Grid.Row="6" Grid.Column="2" 
                            Style="{StaticResource ValueStyle}"
                            HorizontalAlignment="Right"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Recommendation Card -->
                    <Border Background="{StaticResource FallbackCardBackground}" 
                    CornerRadius="4" 
                    Padding="16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <ui:SymbolIcon Symbol="{Binding RecommendationIcon}"
                                      Foreground="{Binding RecommendationIconColor}"
                                       Margin="0,-10,8,0"/>
                                <TextBlock Text="Recommendation" Style="{StaticResource SectionHeaderStyle}"/>
                            </StackPanel>

                            <TextBlock Text="{Binding Recommendation}" Style="{StaticResource RecommendationStyle}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ui:DynamicScrollViewer>
        </Grid>
    </Grid>
</Page>
    